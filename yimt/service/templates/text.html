<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <link rel="stylesheet" type="text/css" href="../static/text.css">
    <script src="../static/common.js" type="text/javascript"></script>
    <script>
        var API_KEY = "";
        var END_POINT = "http://127.0.0.1:5555";
        window.onload = function()
        {
            var server = window.localStorage.getItem("server");
            var key = window.localStorage.getItem("key");
            API_KEY=key;
            if(!!server)
            {
                END_POINT = server;
            }

            var userAgentInfo = navigator.userAgent;
            var Agents = ["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];
            var flag = true;
            for(var v=0;v<Agents.length;v++)
            {
                if(userAgentInfo.indexOf(Agents[v])>0)
                {
                    flag=false;
                    break;
                }
            }
            var tag = window.localStorage.getItem("tag");
            //alert(tag);
            if(!flag&&tag!="jump")
            {
                window.location.href="{{url_for('mobile')}}"
            }
            get_common_html();
            document.getElementById("url_setting_label").addEventListener("click", url_setting_func);
            request_ad();  
        }

        async function request_ad(){
            const res = await fetch(END_POINT + "/request_ad", {
                method: "POST",
                body: JSON.stringify({platform:"web"}),
                headers: { "Content-Type": "application/json" },
                }
            );
            trans_json = await res.json();
            ad_id = trans_json.ad_id;
            type = trans_json.type;
            content = trans_json.content;
            url = trans_json.url;
            console.log("ad_id:"+ad_id);
            console.log("ad_type:"+type);
            //console.log("ad_content:"+content);
            //console.log("ad_url:"+url);
            //document.getElementById("content").setAttribute("",)
            if(url != ""){
                ad_url = document.getElementById("product1_url");
                ad_url.style.visibility='visible';
                ad_url.href = url;
                //console.log("ad_url.href: "+ad_url.href);
            }else{
                document.getElementById("product1_url").style.visibility='hidden';
            }
            if(type == "text"){
                document.getElementById("product1_content").style.visibility='visible';
                document.getElementById("product1_content").innerText = content;
                //console.log(content);
            }else if(type == "image"){
                document.getElementById("product1_content").style.visibility='hidden';
                const base64String = content;
                ad_img_div = document.getElementById("product1_area");
                ad_img_div.style.backgroundImage='url('+'data:image/png;base64,'+content+')';
                ad_img_div.style.backgroundSize = "contain";
                ad_img_div.style.backgroundPosition = "center";
                ad_img_div.style.backgroundRepeat = "no-repeat";
            }else{
                document.getElementById("product1_content").innerText = "出错啦";
            }
        }

        async function translate_func(){
            qstr = document.getElementById('q').value;
            qstr = qstr.trim();
            if(qstr.length==0) return;
            source_lang = document.getElementById('source').value;
            target_lang = document.getElementById('target').value;
            const res = await fetch(END_POINT + "/translate", {
                method: "POST",
                body: JSON.stringify({q: qstr, source: source_lang, target: target_lang, api_key:API_KEY, format: "text"}),
                headers: { "Content-Type": "application/json" }}
            );

            trans_json = await res.json();
            if(res.ok){
                console.log(trans_json);
                //p = trans_json.translatedText.replace("\n", "<br>");
                document.getElementById('translation').value = trans_json.translatedText;
            }
            else{
                document.getElementById('translation').value = '';
                alert(trans_json.error)
            }
        }

    </script>
    <title>YiMT Translation</title>
</head>

<body>
    <div class="mask" id="mask"></div>
    <div class="url_setting_block" id="url_setting_block"></div>
   
    <div class="fanyi__nav" id="fanyi__nav">

        <script>
            function url_setting_func()
            {
                document.getElementById("url_setting_block").style.visibility='visible';
                document.getElementById("mask").style.display='block';
                document.getElementById("url").value=END_POINT;
                document.getElementById("api_key").value=API_KEY;
            }
            
            function url_resetting_func()
            {
                END_POINT = document.getElementById("url").value;
                window.localStorage.setItem("server", END_POINT);
                
                document.getElementById("url_setting_block").style.visibility='hidden';
                document.getElementById("mask").style.display='none';

                API_KEY = document.getElementById("api_key").value;
                window.localStorage.setItem("key",API_KEY);
            }
         
            function url_setting_hide_func()
            {
                document.getElementById("url_setting_block").style.visibility='hidden';
                document.getElementById("mask").style.display='none'
            }

        </script>
    </div>

    <div class="restriction">
        <div class="fanyi__operations">
            <div class="fanyi__operations--left">
                <div id="toolbar">
                    <select id="source" name="source" class="source_select">
                        <option value="auto">自动检测</option>
                        <option value="zh">Chinese</option>
                        <option value="en">English</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="de">German</option>
                        <option value="vi">Vietnamese</option>
                        <option value="ru">Russian</option>
                        <option value="ar">Arabic</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="pt">Portuguese</option>
                        <option value="ms">Malay</option>
                        <option value="hi">Hindi</option>
                        <option value="it">Italian</option>
                        <option value="th">Thai</option>
                        <option value="id">Indonesian</option>
                    </select>
                    <span class="mid">-></span>
                    <select id="target" name="target" class="target_select">
                        <option value="zh">Chinese</option>
                        <option value="en">English</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="de">German</option>
                        <option value="vi">Vietnamese</option>
                        <option value="ru">Russian</option>
                        <option value="ar">Arabic</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="pt">Portuguese</option>
                        <option value="ms">Malay</option>
                        <option value="hi">Hindi</option>
                        <option value="it">Italian</option>
                        <option value="th">Thai</option>
                        <option value="id">Indonesian</option>
                    </select>
                    <input type="button" class="fanyi__operations--machine" id="transMachine" value="翻译文本" onclick='translate_func()'>

                </div>
            </div>
        </div>

        <div class="fanyi__input">
            <div class="input__original">
                <div class="fanyi__input__bg">
                    <textarea id="q" name="q" rows="20" maxlength="500" cols="50" class="input__original__area" placeholder="请输入您要翻译的文字"></textarea>

                    <script>
                        document.getElementById("q").oninput = function() {myFunction();getc_num()};
                        function myFunction() {
                            document.getElementById("inputDelete").style.visibility='visible';
                            document.getElementById("target_copy").style.visibility='visible';
                            document.getElementById("words_count").style.visibility='visible';
                            if(document.getElementById("q").value=='')
                            {
                                document.getElementById("inputDelete").style.visibility='hidden';
                                document.getElementById("target_copy").style.visibility='hidden';
                                document.getElementById("words_count").style.visibility='hidden';

                            }
                        }
                        function getc_num()
                        {
                            document.getElementById("c1").innerHTML=document.getElementById("q").value.length;
                        }         
                    </script>

                    <a id="inputDelete" class="input__original_delete"></a>
                    <div id="words_count" class="words_count" style="visibility: hidden;">
                        <span id="c1"></span>/500
                    </div>
                    <script>
                        function clear_func()
                        {
                            document.getElementById("q").value='';
                            document.getElementById("translation").value='';
                            getc_num();
                        }    
                        document.getElementById("inputDelete").addEventListener("click", clear_func);
                    </script>
                </div>
                
                <!--<input type="button" value="翻译文档" class="fanyi__operations--file" onclick="window.location.href='/file'">-->
            </div>

            <div class="input__target">
                <div class="fanyi__input__bg">
                    <textarea id="translation" name="translation" rows="20" cols="50" class="input__target__area"></textarea>
                    <a id="target_copy" class="target_copy"></a>
                </div>
                <script>
                    document.getElementById("target_copy").addEventListener("click", copy_func);
                    function copy_func()
                    { 
                        translation.select();
                        document.execCommand("Copy");
                    }
                    
                </script>
            </div>
        </div>
    
        <div class="inside__products" id="inside__products" style="display: block;"></div>
    </div>

    <div class="fanyi__footer" id="fanyi__footer"></div>
</body>
</html>